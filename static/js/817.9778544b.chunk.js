!function(){"use strict";var t={92360:function(t,e,n){n.d(e,{fE:function(){return u},YW:function(){return l},nt:function(){return c},qp:function(){return _}});var i=n(70885),s=n(15671),o=n(43144),r=n(14440),a=n(32166),h=n(46775),u=function(){function t(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;(0,s.Z)(this,t),this.leftHanded=n,this.eps=i,this._data=t.getOriginalCoordVectors(),e&&e.every((function(t){return(0,h.$8)(t)}))&&this.set(e),this._data.forEach((function(t){Object.freeze(t)}))}return(0,o.Z)(t,[{key:"x",get:function(){return this._data[0]}},{key:"y",get:function(){return this._data[1]}},{key:"z",get:function(){return this._data[2]}},{key:"get",value:function(){return this._data}},{key:"set",value:function(t){this.x.copyFrom(t[0]),this.y.copyFrom(t[1]),this.z.copyFrom(t[2]),this.verifyBasis()}},{key:"verifyBasis",value:function(){var t=this.leftHanded?this.z:this.z.negate();if(!(0,a.mT)(this.x.cross(this.y),t,this.eps))throw Error("Basis is not correct!")}},{key:"rotateByQuaternion",value:function(e){var n=[r.Vector3.Zero(),r.Vector3.Zero(),r.Vector3.Zero()];return this._data.map((function(t,i){t.rotateByQuaternionToRef(e,n[i])})),new t(n)}},{key:"negateAxes",value:function(e){var n=this.x.clone(),i=this.y.clone(),s=this.z.clone();switch(e){case a.bN.x:n.negateInPlace();break;case a.bN.y:i.negateInPlace();break;case a.bN.z:s.negateInPlace();break;case a.bN.xy:n.negateInPlace(),i.negateInPlace();break;case a.bN.yz:i.negateInPlace(),s.negateInPlace();break;case a.bN.xz:n.negateInPlace(),s.negateInPlace();break;case a.bN.xyz:n.negateInPlace(),i.negateInPlace(),s.negateInPlace();break;default:throw Error("Unknown axis!")}return new t([n,i,s])}},{key:"transpose",value:function(e){if(!(0,h.$x)(new Set(e),new Set([0,1,2])))return console.error("Basis transpose failed: wrong input."),this;var n=[this.x.clone(),this.y.clone(),this.z.clone()];return new t(e.map((function(t){return n[t]})))}}],[{key:"getOriginalCoordVectors",value:function(){return t.ORIGINAL_CARTESIAN_BASIS_VECTORS.map((function(t){return t.clone()}))}}]),t}();function l(t,e,n){var i=t,s=e;if(void 0!==n){var o=r.Quaternion.Inverse(n);i=t.rotateByQuaternion(o),s=e.rotateByQuaternion(o)}var a=r.Quaternion.RotationQuaternionFromAxis(i.x.clone(),i.y.clone(),i.z.clone()),h=r.Quaternion.RotationQuaternionFromAxis(s.x.clone(),s.y.clone(),s.z.clone()),u=a.clone().normalize(),l=r.Quaternion.Inverse(u);return h.clone().normalize().multiply(l)}function c(t){var e=(0,i.Z)(t,3),n=e[0],s=e[1],o=e[2],a=r.Plane.FromPoints(n,s,o).normalize(),h=s.subtract(n).normalize(),l=a.normal,c=n.add(h.scale(r.Vector3.Dot(o.subtract(n),h)/r.Vector3.Dot(h,h))),_=o.subtract(c).normalize();return new u([h,_,l])}function _(t,e){if(0===t.length)return[r.Vector3.Zero()];var n=t.reduce((function(t,e){return t.add(e)})).scale(1/t.length);return t.map((function(t){return t.subtract(e.scale(r.Vector3.Dot(e,t.subtract(n))))}))}u.ORIGINAL_CARTESIAN_BASIS_VECTORS=[new r.Vector3(1,0,0),new r.Vector3(0,1,0),new r.Vector3(0,0,1)]},57981:function(t,e,n){n.d(e,{n0:function(){return h},DN:function(){return l},dY:function(){return c},zQ:function(){return _}});var i=n(15671),s=n(43144),o=n(14440),r=n(26985),a=n.n(r),h=.6,u=function(){var t=Math.sqrt(2*Math.PI);return function(e,n){var i,s=e/2|0,o=new Array(2*s+1),r=1/(t*n),a=2*n*n,h=0;for(i=-s;i<=s;i++)h+=o[s+i]=r*Math.exp(-i*i/a);for(i=0;i<o.length;i++)o[i]/=h;return o}}(),l=function(){function t(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Vector3.Zero(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;(0,i.Z)(this,t),this.t_prev=e,this.x_prev=n,this.dx_prev=s,this.min_cutoff=r,this.beta=a,this.d_cutoff=h}return(0,s.Z)(t,[{key:"next",value:function(e,n){var i=e-this.t_prev,s=t.smoothing_factor(i,this.d_cutoff),o=n.subtract(this.x_prev).scaleInPlace(1/i),r=t.exponential_smoothing(s,o,this.dx_prev),a=this.min_cutoff+this.beta*r.length(),h=t.smoothing_factor(i,a),u=t.exponential_smoothing(h,n,this.x_prev);return this.x_prev=u,this.dx_prev=r,this.t_prev=e,u}}],[{key:"smoothing_factor",value:function(t,e){var n=2*Math.PI*e*t;return n/(n+1)}},{key:"exponential_smoothing",value:function(t,e,n){return e.scale(t).addInPlace(n.scale(1-t))}}]),t}(),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;(0,i.Z)(this,t),this.R=e,this.Q=n,this.kalmanFilterX=new(a())({Q:n,R:e}),this.kalmanFilterY=new(a())({Q:n,R:e}),this.kalmanFilterZ=new(a())({Q:n,R:e})}return(0,s.Z)(t,[{key:"next",value:function(t,e){var n=[this.kalmanFilterX.filter(e.x),this.kalmanFilterY.filter(e.y),this.kalmanFilterZ.filter(e.z)];return o.Vector3.FromArray(n)}}]),t}(),_=function(){function t(e,n){if((0,i.Z)(this,t),this.size=e,this.sigma=n,this._values=[],e<2)throw RangeError("Filter size too short");this.size=Math.floor(e),this.kernel=u(e,n)}return(0,s.Z)(t,[{key:"values",get:function(){return this._values}},{key:"push",value:function(t){this.values.push(t),this.values.length===this.size+1?this.values.shift():this.values.length>this.size+1&&(console.warn("Internal queue has length longer than size: ".concat(this.size)),this.values.slice(-this.size))}},{key:"reset",value:function(){this.values.length=0}},{key:"apply",value:function(){if(this.values.length!==this.size)return o.Vector3.Zero();for(var t=o.Vector3.Zero(),e=t.length(),n=0;n<this.size;++n)t.addInPlace(this.values[n].scale(this.kernel[n]));var i=t.length();return t.scaleInPlace(e/i),t}}]),t}()},85996:function(t,e,n){n.d(e,{Hm:function(){return h},zL:function(){return u},WS:function(){return l},yF:function(){return c},R$:function(){return _},eI:function(){return f},KS:function(){return d},$D:function(){return y},TY:function(){return p},I1:function(){return I}});var i=n(15671),s=n(43144),o=n(14440),r=n(57981),a=n(46775),h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{oneEuroCutoff:.01,oneEuroBeta:0,type:"OneEuro"};if((0,i.Z)(this,t),this.gaussianVectorFilter=null,this._t=0,this._pos=o.Vector3.Zero(),this.visibility=0,"Kalman"===e.type)this.mainFilter=new r.dY(e.R,e.Q);else{if("OneEuro"!==e.type)throw Error("Wrong filter type!");this.mainFilter=new r.DN(this.t,this.pos,o.Vector3.Zero(),e.oneEuroCutoff,e.oneEuroBeta)}e.gaussianSigma&&(this.gaussianVectorFilter=new r.zQ(5,e.gaussianSigma))}return(0,s.Z)(t,[{key:"t",get:function(){return this._t},set:function(t){this._t=t}},{key:"pos",get:function(){return this._pos}},{key:"updatePosition",value:function(t,e){this.t+=1,(void 0===e||e>r.n0)&&(t=this.mainFilter.next(this.t,t),this.gaussianVectorFilter&&(this.gaussianVectorFilter.push(t),t=this.gaussianVectorFilter.apply()),this._pos=t,this.visibility=e)}}]),t}(),u=33,l=478,c=21,_=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new o.Vector3(t.x*e,n?-t.y*e:t.y*e,t.z*e)},f=function(t){return{x:t.x,y:t.y,z:t.z}},d={WRIST:0,THUMB_CMC:1,THUMB_MCP:2,THUMB_IP:3,THUMB_TIP:4,INDEX_FINGER_MCP:5,INDEX_FINGER_PIP:6,INDEX_FINGER_DIP:7,INDEX_FINGER_TIP:8,MIDDLE_FINGER_MCP:9,MIDDLE_FINGER_PIP:10,MIDDLE_FINGER_DIP:11,MIDDLE_FINGER_TIP:12,RING_FINGER_MCP:13,RING_FINGER_PIP:14,RING_FINGER_DIP:15,RING_FINGER_TIP:16,PINKY_MCP:17,PINKY_PIP:18,PINKY_DIP:19,PINKY_TIP:20},y={Hand:d.WRIST,ThumbProximal:d.THUMB_CMC,ThumbIntermediate:d.THUMB_MCP,ThumbDistal:d.THUMB_IP,IndexProximal:d.INDEX_FINGER_MCP,IndexIntermediate:d.INDEX_FINGER_PIP,IndexDistal:d.INDEX_FINGER_DIP,MiddleProximal:d.MIDDLE_FINGER_MCP,MiddleIntermediate:d.MIDDLE_FINGER_PIP,MiddleDistal:d.MIDDLE_FINGER_DIP,RingProximal:d.RING_FINGER_MCP,RingIntermediate:d.RING_FINGER_PIP,RingDistal:d.RING_FINGER_DIP,LittleProximal:d.PINKY_MCP,LittleIntermediate:d.PINKY_PIP,LittleDistal:d.PINKY_DIP},m=(0,a.LE)(y);function p(t,e){if(!(t in m))throw Error("Wrong landmark given!");return(e?"left":"right")+m[t]}function I(t,e){var n=[],i=new Map;for(n.push(t);0!==n.length;){var s=n.splice(-1,1)[0];if(e(s))return[s,i];var o=s.children;if(null!==o)for(var r=0;r<o.length;r++){var a=o[r];n.push(a),i.has(a)||i.set(a,s)}}return[null,null]}},32166:function(t,e,n){n.d(e,{pc:function(){return _},hX:function(){return f},On:function(){return d},bN:function(){return i},Gw:function(){return I},mT:function(){return L},ku:function(){return R},nx:function(){return E},cd:function(){return P},Lf:function(){return g},Lq:function(){return b}});var i,s=n(60136),o=n(43668),r=n(43144),a=n(15671),h=n(14440),u=n(46775),l=n(92360),c=(n(85996),n(57981)),_=function(t){(0,s.Z)(n,t);var e=(0,o.Z)(n);function n(t,i){var s;return(0,a.Z)(this,n),(s=e.call(this,t))._baseBasis=i||new l.fE(null),s}return(0,r.Z)(n,[{key:"baseBasis",get:function(){return this._baseBasis}},{key:"set",value:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w}},{key:"rotateBasis",value:function(t){return this._baseBasis.rotateByQuaternion(t)}}]),n}((0,r.Z)((function t(e){(0,a.Z)(this,t),this.x=0,this.y=0,this.z=0,this.w=1,e&&(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w)}))),f=function(t){return new h.Quaternion(t.x,t.y,t.z,t.w)},d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{R:1,Q:1,type:"Kalman"};if((0,a.Z)(this,t),this.gaussianVectorFilter=null,this._t=0,this._rot=h.Quaternion.Identity(),"Kalman"!==e.type)throw Error("Wrong filter type!");this.mainFilter=new c.dY(e.R,e.Q),e.gaussianSigma&&(this.gaussianVectorFilter=new c.zQ(5,e.gaussianSigma))}return(0,r.Z)(t,[{key:"t",get:function(){return this._t},set:function(t){this._t=t}},{key:"rot",get:function(){return this._rot}},{key:"updateRotation",value:function(t){this.t+=1;var e=t.toEulerAngles();e=this.mainFilter.next(this.t,e),this.gaussianVectorFilter&&(this.gaussianVectorFilter.push(e),e=this.gaussianVectorFilter.apply()),this._rot=h.Quaternion.FromEulerVector(e)}}]),t}();!function(t){t[t.x=0]="x",t[t.y=1]="y",t[t.z=2]="z",t[t.xy=3]="xy",t[t.yz=4]="yz",t[t.xz=5]="xz",t[t.xyz=6]="xyz",t[t.none=10]="none"}(i||(i={}));var y=function(t){return h.Angle.FromRadians(t).degrees()},m=function(t){return h.Angle.FromDegrees(t).radians()};var p=function(t,e){var n=h.Vector3.GetAngleBetweenVectors(t,e,h.Vector3.Cross(t,e)),i=h.Vector3.Cross(t,e);return i.normalize(),h.Quaternion.RotationAxis(i,n)},I=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return v(p(t,e),n)},k=function(t){return(t=(0,u.Ae)(t,0,360))<180?t:t-360},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.toEulerAngles(),i=e?k:function(t){return t};return new h.Vector3(i(y(n.x)),i(y(n.y)),i(y(n.z)))};function L(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return t.cross(e).length()<n&&h.Vector3.Dot(t,e)>0}var R=function(t,e){if(e===i.none)return t;var n=t.toEulerAngles();switch(e){case i.x:n.x=-n.x;break;case i.y:n.y=-n.y;break;case i.z:n.z=-n.z;break;case i.xy:n.x=-n.x,n.y=-n.y;break;case i.yz:n.y=-n.y,n.z=-n.z;break;case i.xz:n.x=-n.x,n.z=-n.z;break;case i.xyz:n.x=-n.x,n.y=-n.y,n.z=-n.z;break;default:throw Error("Unknown axis!")}return h.Quaternion.RotationYawPitchRoll(n.y,n.x,n.z)},E=function(t,e,n,s,o,r,a,l){var c=v(t,!0);switch(e){case i.none:break;case i.x:c.x=0;break;case i.y:c.y=0;break;case i.z:c.z=0;break;case i.xy:c.x=0,c.y=0;break;case i.yz:c.y=0,c.z=0;break;case i.xz:c.x=0,c.z=0;break;case i.xyz:c.x=0,c.y=0,c.z=0;break;default:throw Error("Unknown axis!")}if(void 0!==n&&void 0!==s&&void 0!==o)switch(n){case i.x:c.x=(0,u.Ae)(c.x,s,o);break;case i.y:c.y=(0,u.Ae)(c.y,s,o);break;case i.z:c.z=(0,u.Ae)(c.z,s,o);break;default:throw Error("Unknown cap axis!")}if(void 0!==r&&void 0!==a&&void 0!==l)switch(r){case i.x:c.x=(0,u.Ae)(c.x,a,l);break;case i.y:c.y=(0,u.Ae)(c.y,a,l);break;case i.z:c.z=(0,u.Ae)(c.z,a,l);break;default:throw Error("Unknown cap axis!")}return h.Quaternion.RotationYawPitchRoll(m(c.y),m(c.x),m(c.z))};function P(t,e){var n=h.Quaternion.Inverse(h.Quaternion.RotationQuaternionFromAxis(e.x.clone(),e.y.clone(),e.z.clone())).normalize(),i=h.Vector3.Zero();t.rotateByQuaternionToRef(n,i),i.normalize();var s=i.x,o=i.y,r=i.z;return[Math.acos(r),Math.atan2(o,s)]}function g(t,e,n,i){var s=h.Quaternion.RotationAxis(t.y.clone(),-Math.PI/2),o=t.rotateByQuaternion(s),r=h.Quaternion.RotationAxis(o.x.clone(),n),a=o.rotateByQuaternion(r),u=h.Quaternion.RotationAxis(a.y.clone(),e),c=a.rotateByQuaternion(u),_=h.Plane.FromPositionAndNormal(h.Vector3.Zero(),t.y.clone()),f=c,d=h.Vector3.Cross(f.x.clone(),_.normal),y=h.Vector3.Cross(d,f.x.clone()),m=new l.fE([f.x,y,d]);return(0,l.YW)(t,m,i)}function b(t,e){var n=t.toEulerAngles();return n.scaleInPlace(e),h.Quaternion.FromEulerVector(n)}},46775:function(t,e,n){n.d(e,{TZ:function(){return a},LE:function(){return h},Ae:function(){return u},p6:function(){return l},L2:function(){return c},$8:function(){return _},$x:function(){return f},Fv:function(){return d},yp:function(){return y},LR:function(){return m},gS:function(){return p}});var i=n(15671),s=n(43144),o=n(37762),r=n(14440);function a(t,e){for(var n=new Array(t),i=0;i<t;i++)n[i]=e(i);return n}function h(t){var e={};return Object.keys(t).forEach((function(n){e[t[n]]=n})),e}var u=function(t,e,n){if(e>n){var i=n;n=e,e=i}return Math.max(Math.min(t,n),e)},l=function(t,e,n,i,s){return i+(u(t,e,n)-e)*(s-i)/(n-e)},c=function(t,e,n,i,s){return i+(t-e)*(s-i)/(n-e)};function _(t){return Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)}function f(t,e){if(t.size!==e.size)return!1;var n,i=(0,o.Z)(t);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(!e.has(s))return!1}}catch(r){i.e(r)}finally{i.f()}return!0}function d(t,e){return e.subtract(t.normal.scale(r.Vector3.Dot(e,t.normal)))}var y=function(){function t(e){(0,i.Z)(this,t),this.size=e,this._values=[]}return(0,s.Z)(t,[{key:"values",get:function(){return this._values}},{key:"push",value:function(t){this.values.push(t),this.values.length===this.size+1?this.values.shift():this.values.length>this.size+1&&(console.warn("Internal queue has length longer than size ".concat(this.size,": Got length ").concat(this.values.length)),this._values=this.values.slice(-this.size))}},{key:"concat",value:function(t){this._values=this.values.concat(t),this.values.length>this.size&&(this._values=this.values.slice(-this.size))}},{key:"pop",value:function(){return this.values.shift()}},{key:"first",value:function(){return this._values.length>0?this.values[0]:null}},{key:"last",value:function(){return this._values.length>0?this._values[this._values.length-1]:null}},{key:"reset",value:function(){this.values.length=0}},{key:"length",value:function(){return this.values.length}}]),t}();var m=["left","right"];function p(t,e,n){var i=n.subtract(e).normalize(),s=e.add(i.scale(r.Vector3.Dot(t.subtract(e),i)/r.Vector3.Dot(i,i)));return t.subtract(s).length()}},34817:function(t,e,n){var i=n(70885),s=n(37762),o=n(43144),r=n(15671),a=n(43189),h=n(74492),u=n(14440),l=n(46775),c=n(85996),_=n(32166),f=n(92360),d=n(57981),y=(0,o.Z)((function t(){(0,r.Z)(this,t),this.top_face_oval=new c.Hm,this.left_face_oval=new c.Hm,this.bottom_face_oval=new c.Hm,this.right_face_oval=new c.Hm,this.left_eye_top=new c.Hm,this.left_eye_bottom=new c.Hm,this.left_eye_inner=new c.Hm,this.left_eye_outer=new c.Hm,this.left_eye_inner_secondary=new c.Hm,this.left_eye_outer_secondary=new c.Hm,this.left_iris_top=new c.Hm,this.left_iris_bottom=new c.Hm,this.left_iris_left=new c.Hm,this.left_iris_right=new c.Hm,this.right_eye_top=new c.Hm,this.right_eye_bottom=new c.Hm,this.right_eye_inner=new c.Hm,this.right_eye_outer=new c.Hm,this.right_eye_inner_secondary=new c.Hm,this.right_eye_outer_secondary=new c.Hm,this.right_iris_top=new c.Hm,this.right_iris_bottom=new c.Hm,this.right_iris_left=new c.Hm,this.right_iris_right=new c.Hm,this.mouth_top_first=new c.Hm,this.mouth_top_second=new c.Hm,this.mouth_top_third=new c.Hm,this.mouth_bottom_first=new c.Hm,this.mouth_bottom_second=new c.Hm,this.mouth_bottom_third=new c.Hm,this.mouth_left=new c.Hm,this.mouth_right=new c.Hm})),m=function(){function t(e,n){(0,r.Z)(this,t),this._boneRotationUpdateFn=null,this.bonesHierarchyTree=null,this.cloneableInputResults=null,this.inputPoseLandmarks=(0,l.TZ)(c.zL,(function(){return{x:0,y:0,z:0}})),this.poseLandmarks=(0,l.TZ)(c.zL,(function(){return new c.Hm({R:.1,Q:5,type:"Kalman"})})),this.worldPoseLandmarks=(0,l.TZ)(c.zL,(function(){return new c.Hm({R:.1,Q:1,type:"Kalman"})})),this.cloneablePoseLandmarks=(0,l.TZ)(c.zL,(function(){return{x:0,y:0,z:0}})),this.inputFaceLandmarks=(0,l.TZ)(c.WS,(function(){return{x:0,y:0,z:0}})),this.faceLandmarks=(0,l.TZ)(c.WS,(function(){return new c.Hm({R:.1,Q:1,type:"Kalman"})})),this._faceMeshLandmarkIndexList=[],this._faceMeshLandmarkList=[],this.leftWristOffset=new c.Hm({R:.1,Q:2,type:"Kalman"}),this.inputLeftHandLandmarks=(0,l.TZ)(c.yF,(function(){return{x:0,y:0,z:0}})),this.leftHandLandmarks=(0,l.TZ)(c.yF,(function(){return new c.Hm({R:1,Q:10,type:"Kalman"})})),this.cloneableLeftHandLandmarks=(0,l.TZ)(c.yF,(function(){return{x:0,y:0,z:0}})),this.leftHandNormal=u.Vector3.Zero(),this.rightWristOffset=new c.Hm({R:.1,Q:2,type:"Kalman"}),this.inputRightHandLandmarks=(0,l.TZ)(c.yF,(function(){return{x:0,y:0,z:0}})),this.rightHandLandmarks=(0,l.TZ)(c.yF,(function(){return new c.Hm({R:1,Q:10,type:"Kalman"})})),this.cloneableRightHandLandmarks=(0,l.TZ)(c.yF,(function(){return{x:0,y:0,z:0}})),this.rightHandNormal=u.Vector3.Zero(),this.leftFootNormal=u.Vector3.Zero(),this.rightFootNormal=u.Vector3.Zero(),this.leftFootBasisRotation=u.Quaternion.Identity(),this.rightFootBasisRotation=u.Quaternion.Identity(),this._keyPoints=new y,this._blinkBase=new c.Hm({R:1,Q:1,type:"Kalman"}),this._leftBlinkArr=new l.yp(10),this._rightBlinkArr=new l.yp(10),this._faceNormal={x:0,y:0,z:0},this._headQuaternion=new _.On({R:1,Q:50,type:"Kalman"}),this._initBoneRotations={},this._boneRotations={},this.textEncoder=new TextEncoder,this._leftHandNormals=(0,l.TZ)(3,(function(){return{x:0,y:0,z:0}})),this._rightHandNormals=(0,l.TZ)(3,(function(){return{x:0,y:0,z:0}})),this._poseNormals=(0,l.TZ)(3,(function(){return{x:0,y:0,z:0}})),this.midHipPos=null,this.midHipInitOffset=null,this.midHipOffset=new c.Hm({R:1,Q:10,type:"Kalman"}),this.initBoneRotations(),this._boneOptions=e,n&&(this._boneRotationUpdateFn=n)}return(0,o.Z)(t,[{key:"updateBoneOptions",value:function(t){this._boneOptions=t}},{key:"faceMeshLandmarkIndexList",get:function(){return this._faceMeshLandmarkIndexList}},{key:"faceMeshLandmarkList",get:function(){return this._faceMeshLandmarkList}},{key:"keyPoints",get:function(){return this._keyPoints}},{key:"faceNormal",get:function(){return this._faceNormal}},{key:"leftHandNormals",get:function(){return this._leftHandNormals}},{key:"rightHandNormals",get:function(){return this._rightHandNormals}},{key:"poseNormals",get:function(){return this._poseNormals}},{key:"setBonesHierarchyTree",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.bonesHierarchyTree&&!n||(this.bonesHierarchyTree=t,this._initBoneRotations={},(0,c.I1)(this.bonesHierarchyTree,(function(t){return e._initBoneRotations[t.name]=new _.pc(u.Quaternion.Identity()),!1})),this.initBoneRotations())}},{key:"process",value:function(t){if(this.cloneableInputResults=t,this.cloneableInputResults){this._boneOptions.resetInvisible&&this.resetBoneRotations(),this.preProcessResults(),this.toCloneableLandmarks(this.poseLandmarks,this.cloneablePoseLandmarks),this.filterFaceLandmarks(),this.toCloneableLandmarks(this.leftHandLandmarks,this.cloneableLeftHandLandmarks),this.toCloneableLandmarks(this.rightHandLandmarks,this.cloneableRightHandLandmarks),this.getKeyPoints(),this.calcIrisNormal(),this.calcFaceBones(),this.calcExpressions(),this.calcPoseBones(),this.calcHandBones(),this._boneOptions.irisLockX&&(this._boneRotations.iris.set((0,_.nx)((0,_.hX)(this._boneRotations.iris),_.bN.x)),this._boneRotations.leftIris.set((0,_.nx)((0,_.hX)(this._boneRotations.iris),_.bN.x)),this._boneRotations.rightIris.set((0,_.nx)((0,_.hX)(this._boneRotations.iris),_.bN.x)));var e=[];if(this._boneOptions.resetInvisible){var n,i;if(((null===(n=this.cloneableInputResults)||void 0===n?void 0:n.poseLandmarks[h.POSE_LANDMARKS.LEFT_WRIST].visibility)||0)<d.n0)for(var o=0,r=Object.keys(c.$D);o<r.length;o++){var a=r[o],u="left".concat(a);e.push(u)}if(((null===(i=this.cloneableInputResults)||void 0===i?void 0:i.poseLandmarks[h.POSE_LANDMARKS.RIGHT_WRIST].visibility)||0)<d.n0)for(var f=0,y=Object.keys(c.$D);f<y.length;f++){var m=y[f],p="right".concat(m);e.push(p)}}if(this._boneOptions.lockFinger){var I,k=(0,s.Z)(l.LR);try{for(k.s();!(I=k.n()).done;)for(var v=I.value,L=0,R=Object.keys(c.$D);L<R.length;L++){var E=v+R[L];e.push(E)}}catch(S){k.e(S)}finally{k.f()}}if(this._boneOptions.lockArm){var P,g=(0,s.Z)(l.LR);try{for(g.s();!(P=g.n()).done;){var b=P.value;e.push("".concat(b,"UpperArm")),e.push("".concat(b,"LowerArm"))}}catch(S){g.e(S)}finally{g.f()}}if(this._boneOptions.lockLeg){var N,w=(0,s.Z)(l.LR);try{for(w.s();!(N=w.n()).done;){var A=N.value;e.push("".concat(A,"UpperLeg")),e.push("".concat(A,"LowerLeg")),e.push("".concat(A,"Foot"))}}catch(S){w.e(S)}finally{w.f()}}this.filterBoneRotations(e),this.pushBoneRotationBuffer()}}},{key:"resetBoneRotations",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=0,n=Object.entries(this._initBoneRotations);e<n.length;e++){var s=(0,i.Z)(n[e],2),o=s[0],r=s[1];this._boneRotations[o].set((0,_.hX)(r))}t&&this.pushBoneRotationBuffer()}},{key:"filterBoneRotations",value:function(t){var e,n=(0,s.Z)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._boneRotations[i]&&this._boneRotations[i].set(u.Quaternion.Identity())}}catch(o){n.e(o)}finally{n.f()}}},{key:"getKeyPoints",value:function(){this._keyPoints.top_face_oval=this.faceLandmarks[this.faceMeshLandmarkIndexList[7][0]],this._keyPoints.left_face_oval=this.faceLandmarks[this.faceMeshLandmarkIndexList[7][6]],this._keyPoints.bottom_face_oval=this.faceLandmarks[this.faceMeshLandmarkIndexList[7][18]],this._keyPoints.right_face_oval=this.faceLandmarks[this.faceMeshLandmarkIndexList[7][30]],this._keyPoints.left_eye_inner=this.faceLandmarks[this.faceMeshLandmarkIndexList[2][8]],this._keyPoints.right_eye_inner=this.faceLandmarks[this.faceMeshLandmarkIndexList[3][8]],this._keyPoints.left_eye_outer=this.faceLandmarks[this.faceMeshLandmarkIndexList[2][0]],this._keyPoints.right_eye_outer=this.faceLandmarks[this.faceMeshLandmarkIndexList[3][0]],this._keyPoints.mouth_left=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][10]],this._keyPoints.mouth_right=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][0]],this._keyPoints.mouth_top_first=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][24]],this._keyPoints.mouth_top_second=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][25]],this._keyPoints.mouth_top_third=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][26]],this._keyPoints.mouth_bottom_first=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][34]],this._keyPoints.mouth_bottom_second=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][35]],this._keyPoints.mouth_bottom_third=this.faceLandmarks[this.faceMeshLandmarkIndexList[6][36]],this._keyPoints.left_iris_top=this.faceLandmarks[this.faceMeshLandmarkIndexList[4][1]],this._keyPoints.left_iris_bottom=this.faceLandmarks[this.faceMeshLandmarkIndexList[4][3]],this._keyPoints.left_iris_left=this.faceLandmarks[this.faceMeshLandmarkIndexList[4][2]],this._keyPoints.left_iris_right=this.faceLandmarks[this.faceMeshLandmarkIndexList[4][0]],this._keyPoints.right_iris_top=this.faceLandmarks[this.faceMeshLandmarkIndexList[5][1]],this._keyPoints.right_iris_bottom=this.faceLandmarks[this.faceMeshLandmarkIndexList[5][3]],this._keyPoints.right_iris_left=this.faceLandmarks[this.faceMeshLandmarkIndexList[5][2]],this._keyPoints.right_iris_right=this.faceLandmarks[this.faceMeshLandmarkIndexList[5][0]],this._keyPoints.left_eye_top=this.faceLandmarks[this.faceMeshLandmarkIndexList[2][12]],this._keyPoints.left_eye_bottom=this.faceLandmarks[this.faceMeshLandmarkIndexList[2][4]],this._keyPoints.left_eye_inner_secondary=this.faceLandmarks[this.faceMeshLandmarkIndexList[2][14]],this._keyPoints.left_eye_outer_secondary=this.faceLandmarks[this.faceMeshLandmarkIndexList[2][10]],this._keyPoints.right_eye_top=this.faceLandmarks[this.faceMeshLandmarkIndexList[3][12]],this._keyPoints.right_eye_bottom=this.faceLandmarks[this.faceMeshLandmarkIndexList[3][4]],this._keyPoints.right_eye_outer_secondary=this.faceLandmarks[this.faceMeshLandmarkIndexList[3][10]],this._keyPoints.right_eye_inner_secondary=this.faceLandmarks[this.faceMeshLandmarkIndexList[3][14]]}},{key:"calcFaceBones",value:function(){var t=this._keyPoints.left_face_oval.pos.subtract(this._keyPoints.right_face_oval.pos).normalize(),e=this._keyPoints.top_face_oval.pos.subtract(this._keyPoints.bottom_face_oval.pos).normalize();if(0!==t.length()&&0!==e.length()){var n=new f.fE([t,e,u.Vector3.Cross(t,e)]),i=this.applyQuaternionChain("head",!1),s=this._boneRotations.head.rotateBasis(i),o=(0,_.ku)((0,f.YW)(n,s,i),_.bN.x);this._headQuaternion.updateRotation(o);var r=(0,_.Lq)(this._headQuaternion.rot,.5);this._boneRotations.head.set(r),this._boneRotations.neck.set(r)}}},{key:"calcIrisNormal",value:function(){var e;if(null!==(e=this.cloneableInputResults)&&void 0!==e&&e.faceLandmarks){var n=this._keyPoints.left_iris_top.pos.add(this._keyPoints.left_iris_bottom.pos).add(this._keyPoints.left_iris_left.pos).add(this._keyPoints.left_iris_right.pos).scale(.5),i=this._keyPoints.right_iris_top.pos.add(this._keyPoints.right_iris_bottom.pos).add(this._keyPoints.right_iris_left.pos).add(this._keyPoints.right_iris_right.pos).scale(.5),s=this._keyPoints.left_eye_top.pos.add(this._keyPoints.left_eye_bottom.pos).add(this._keyPoints.left_eye_inner_secondary.pos).add(this._keyPoints.left_eye_outer_secondary.pos).scale(.5),o=this._keyPoints.right_eye_top.pos.add(this._keyPoints.right_eye_bottom.pos).add(this._keyPoints.right_eye_outer_secondary.pos).add(this._keyPoints.right_eye_inner_secondary.pos).scale(.5),r=this._keyPoints.left_eye_inner.pos.subtract(this._keyPoints.left_eye_outer.pos).length(),a=this._keyPoints.right_eye_inner.pos.subtract(this._keyPoints.right_eye_outer.pos).length(),h=n.subtract(s).scale(t.EYE_WIDTH_BASELINE/r),c=i.subtract(o).scale(t.EYE_WIDTH_BASELINE/a),_=u.Quaternion.RotationYawPitchRoll((0,l.p6)(h.x,-t.IRIS_MP_X_RANGE,t.IRIS_MP_X_RANGE,-t.IRIS_BJS_X_RANGE,t.IRIS_BJS_X_RANGE),(0,l.p6)(h.y,-t.IRIS_MP_Y_RANGE,t.IRIS_MP_Y_RANGE,-t.IRIS_BJS_Y_RANGE,t.IRIS_BJS_Y_RANGE),0),f=u.Quaternion.RotationYawPitchRoll((0,l.p6)(c.x,-t.IRIS_MP_X_RANGE,t.IRIS_MP_X_RANGE,-t.IRIS_BJS_X_RANGE,t.IRIS_BJS_X_RANGE),(0,l.p6)(c.y,-t.IRIS_MP_Y_RANGE,t.IRIS_MP_Y_RANGE,-t.IRIS_BJS_Y_RANGE,t.IRIS_BJS_Y_RANGE),0);this._boneRotations.leftIris.set(_),this._boneRotations.rightIris.set(f),this._boneRotations.iris.set(this.lRLinkQuaternion(_,f))}}},{key:"calcExpressions",value:function(){var e;if(null!==(e=this.cloneableInputResults)&&void 0!==e&&e.faceLandmarks){var n=(0,l.gS)(this._keyPoints.left_eye_top.pos,this._keyPoints.left_eye_inner.pos,this._keyPoints.left_eye_outer.pos),i=this._keyPoints.left_eye_top.pos.subtract(this._keyPoints.left_eye_bottom.pos).length(),s=(0,l.gS)(this._keyPoints.right_eye_top.pos,this._keyPoints.right_eye_inner.pos,this._keyPoints.right_eye_outer.pos),o=this._keyPoints.right_eye_top.pos.subtract(this._keyPoints.right_eye_bottom.pos).length();this._blinkBase.updatePosition(new u.Vector3(Math.log(n/i+1),Math.log(s/o+1),0));var r=0;this._leftBlinkArr.length()>4&&(r=this._leftBlinkArr.values.reduce((function(t,e,n){return t+(e-t)/(n+1)}),0)-t.BLINK_RATIO_LOW);var a=(0,l.L2)(this._blinkBase.pos.x,t.BLINK_RATIO_LOW+r,t.BLINK_RATIO_HIGH+r,0,1);this._leftBlinkArr.push(this._blinkBase.pos.x);var h=0;this._rightBlinkArr.length()>4&&(h=this._rightBlinkArr.values.reduce((function(t,e,n){return t+(e-t)/(n+1)}),0)-t.BLINK_RATIO_LOW);var c=(0,l.L2)(this._blinkBase.pos.y,t.BLINK_RATIO_LOW+h,t.BLINK_RATIO_HIGH+h,0,1);this._rightBlinkArr.push(this._blinkBase.pos.y);var _=this.lRLink(a,c);this._boneRotations.blink.set(new u.Quaternion(a,c,_,0));var f=this._keyPoints.mouth_left.pos.subtract(this._keyPoints.mouth_right.pos).length(),d=(0,l.p6)(this._keyPoints.mouth_top_first.pos.subtract(this._keyPoints.mouth_bottom_first.pos).length()*t.MOUTH_WIDTH_BASELINE/f,t.MOUTH_MP_RANGE_LOW,t.MOUTH_MP_RANGE_HIGH,0,1),y=(0,l.p6)(this._keyPoints.mouth_top_second.pos.subtract(this._keyPoints.mouth_bottom_second.pos).length()*t.MOUTH_WIDTH_BASELINE/f,t.MOUTH_MP_RANGE_LOW,t.MOUTH_MP_RANGE_HIGH,0,1),m=(0,l.p6)(this._keyPoints.mouth_top_third.pos.subtract(this._keyPoints.mouth_bottom_third.pos).length()*t.MOUTH_WIDTH_BASELINE/f,t.MOUTH_MP_RANGE_LOW,t.MOUTH_MP_RANGE_HIGH,0,1);this._boneRotations.mouth.set(new u.Quaternion((d+y+m)/3,0,0,0))}}},{key:"calcPoseBones",value:function(){var t;if(null!==(t=this.cloneableInputResults)&&void 0!==t&&t.poseLandmarks){var e=this.worldPoseLandmarks[h.POSE_LANDMARKS.LEFT_HIP].pos,n=this.worldPoseLandmarks[h.POSE_LANDMARKS.RIGHT_HIP].pos,o=this.worldPoseLandmarks[h.POSE_LANDMARKS.LEFT_SHOULDER].pos,r=this.worldPoseLandmarks[h.POSE_LANDMARKS.RIGHT_SHOULDER].pos;this.poseNormals.length=0;var a=u.Plane.FromPositionAndNormal(u.Vector3.Zero(),new u.Vector3(0,1,0)),c=e.subtract(n),d=(0,l.Fv)(a,c),y=Math.atan2(d.z,d.x);this._boneRotations.hips.set(u.Quaternion.FromEulerAngles(0,y,0));var m=u.Plane.FromPoints(r,o,n).normal,p=u.Plane.FromPoints(r,o,e).normal.add(m).normalize();if(p.length()>.1){var I=this.applyQuaternionChain("spine",!1),k=this._boneRotations.spine.rotateBasis(I),v=r.subtract(o).normalize(),L=new f.fE([p,v,u.Vector3.Cross(p,v)]);this._boneRotations.spine.set((0,_.ku)((0,f.YW)(k,L,I),_.bN.yz))}this.calcWristBones();var R,E=0,P=0,g=(0,s.Z)(l.LR);try{for(g.s();!(R=g.n()).done;){var b=R.value,N="left"===b;if(this.shallUpdateArm(N)){var w="".concat(b,"UpperArm"),A=this.worldPoseLandmarks[h.POSE_LANDMARKS["".concat(b.toUpperCase(),"_SHOULDER")]].pos,S=this.worldPoseLandmarks[h.POSE_LANDMARKS["".concat(b.toUpperCase(),"_ELBOW")]].pos,x=this.worldPoseLandmarks[h.POSE_LANDMARKS["".concat(b.toUpperCase(),"_WRIST")]].pos,H=S.subtract(A).normalize(),M=this.applyQuaternionChain(w,!1),T=this._boneRotations[w].rotateBasis(M),F=(0,_.cd)(H,T),z=(0,i.Z)(F,2);E=z[0],P=z[1],this._boneRotations[w].set((0,_.ku)((0,_.Lf)(T,E,P,M),_.bN.yz));var O=N?this.leftHandNormal:this.rightHandNormal,B="".concat(b,"LowerArm"),D=x.subtract(S).normalize(),G=this.applyQuaternionChain(B,!1),Q=this._boneRotations[B].rotateBasis(G),V=(0,_.cd)(D,Q),K=(0,i.Z)(V,2);E=K[0],P=K[1],this["".concat(b,"HandNormals")].length=0;var C=(0,_.ku)((0,_.Lf)(Q,E,P,G),_.bN.yz),Z=this.applyXRotationWithChild(B,G,C,O,Q);this._boneRotations[B].set(Z)}}}catch(ft){g.e(ft)}finally{g.f()}this.calcWristBones(!1);var W,Y=(0,s.Z)(l.LR);try{for(Y.s();!(W=Y.n()).done;){var U=W.value,X="left"===U;if(this.shallUpdateLegs(X)){var j=X?h.POSE_LANDMARKS_LEFT:h.POSE_LANDMARKS_RIGHT,$="".concat(U,"UpperLeg"),J="".concat(U,"LowerLeg"),q=this.worldPoseLandmarks[j["".concat(U.toUpperCase(),"_HIP")]].pos,tt=this.worldPoseLandmarks[j["".concat(U.toUpperCase(),"_KNEE")]].pos,et=this.worldPoseLandmarks[j["".concat(U.toUpperCase(),"_ANKLE")]].pos,nt=tt.subtract(q).normalize(),it=this.applyQuaternionChain($,!1),st=this._boneRotations[$].rotateBasis(it),ot=(0,_.cd)(nt,st),rt=(0,i.Z)(ot,2);E=rt[0],P=rt[1],this._boneRotations[$].set((0,_.ku)((0,_.Lf)(st,E,P,it),_.bN.yz));var at=et.subtract(tt).normalize(),ht=this.applyQuaternionChain(J,!1),ut=this._boneRotations[J].rotateBasis(ht),lt=(0,_.cd)(at,ut),ct=(0,i.Z)(lt,2);E=ct[0],P=ct[1];var _t=(0,_.ku)((0,_.Lf)(ut,E,P,ht),_.bN.yz);this._boneRotations[J].set(_t)}}}catch(ft){Y.e(ft)}finally{Y.f()}this.calcFeetBones(!1)}}},{key:"applyXRotationWithChild",value:function(t,e,n,i,s){var o=this._boneRotations[t].rotateBasis(e.multiply((0,_.ku)(n,_.bN.yz))),r=u.Plane.FromPositionAndNormal(u.Vector3.Zero(),o.x.clone()),a=u.Vector3.Zero();(0,l.Fv)(r,i).rotateByQuaternionToRef(u.Quaternion.Inverse(u.Quaternion.RotationQuaternionFromAxis(o.x.clone(),o.y.clone(),o.z.clone())),a);var h=u.Vector3.Zero();(0,l.Fv)(r,o.z.negate()).rotateByQuaternionToRef(u.Quaternion.Inverse(u.Quaternion.RotationQuaternionFromAxis(o.x.clone(),o.y.clone(),o.z.clone())),h),h.normalize();var c=Math.atan2(h.y,-h.z),d=Math.atan2(a.y,-a.z);d>0&&(d-=2*Math.PI),d<1.25*-Math.PI&&(d=c);var y=o.rotateByQuaternion(u.Quaternion.RotationAxis(o.x.clone(),.5*(d-c))),m=(0,f.YW)(s,y,e);return(0,_.ku)(m,_.bN.yz)}},{key:"calcWristBones",value:function(){for(var e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],s={left:this.leftHandLandmarks,right:this.rightHandLandmarks},o=function(){var s,o=(0,i.Z)(a[r],2),l=o[0],y=o[1],m="left"===l;if(((null===(s=e.cloneableInputResults)||void 0===s?void 0:s.poseLandmarks[m?h.POSE_LANDMARKS.LEFT_WRIST:h.POSE_LANDMARKS.RIGHT_WRIST].visibility)||0)<=d.n0)return"continue";var p=[[y[c.KS.WRIST],y[c.KS.PINKY_MCP],y[c.KS.INDEX_FINGER_MCP]],[y[c.KS.WRIST],y[c.KS.RING_FINGER_MCP],y[c.KS.INDEX_FINGER_MCP]],[y[c.KS.WRIST],y[c.KS.PINKY_MCP],y[c.KS.MIDDLE_FINGER_MCP]]],I=m?e.leftHandNormal:e.rightHandNormal,k=p.reduce((function(e,n){var i=t.normalFromVertices(n,m);return e.add(i)}),u.Vector3.Zero()).normalize();I.copyFrom(k);var v=e._boneRotations[(0,c.TY)(c.KS.WRIST,m)],L=v.baseBasis,R=(0,f.qp)([y[c.KS.WRIST].pos,y[c.KS.INDEX_FINGER_MCP].pos,y[c.KS.MIDDLE_FINGER_MCP].pos,y[c.KS.RING_FINGER_MCP].pos,y[c.KS.PINKY_MCP].pos],k),E=(0,f.nt)([R[0],R[1],R[4]]).rotateByQuaternion(e.applyQuaternionChain(c.KS.WRIST,m).conjugate()),P=(0,f.YW)(L,E),g=(0,_.ku)(P,_.bN.yz);n||v.set(g)},r=0,a=Object.entries(s);r<a.length;r++)o()}},{key:"calcHandBones",value:function(){for(var t={left:this.leftHandLandmarks,right:this.rightHandLandmarks},e=0,n=Object.entries(t);e<n.length;e++)for(var s=(0,i.Z)(n[e],2),o=s[0],r=s[1],a="left"===o,h=1;h<c.yF;++h)if(h%4!==0){var f=this._boneRotations[(0,c.TY)(h,a)],d=r[h].pos.clone(),y=r[h+1].pos.clone().subtract(d).normalize(),m=this.applyQuaternionChain(h,a),p=f.rotateBasis(m);if(h%4===2||h%4===3){var I=u.Plane.FromPositionAndNormal(u.Vector3.Zero(),p.y.clone());y=(0,l.Fv)(I,y)}var k=(0,_.cd)(y,p),v=(0,i.Z)(k,2),L=v[0],R=v[1],E=void 0,P=a?-1:1,g=h%4===1?h<4?_.bN.none:_.bN.x:h<4?_.bN.xz:_.bN.xy,b=h<4?_.bN.z:_.bN.y,N=h<4?_.bN.y:_.bN.z,w=h<2?15:110;E=(0,_.nx)((0,_.Lf)(p,L,R,m),g,b,-15,15,N,-15*P,P*w),E=(0,_.ku)(E,_.bN.yz),f.set(E)}}},{key:"calcFeetBones",value:function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=(0,s.Z)(l.LR);try{for(n.s();!(t=n.n()).done;){var i=t.value,o="left"===i;if(this.shallUpdateLegs(o)){var r=o?(0,f.nt)([this.worldPoseLandmarks[h.POSE_LANDMARKS_LEFT.LEFT_HEEL].pos,this.worldPoseLandmarks[h.POSE_LANDMARKS_LEFT.LEFT_FOOT_INDEX].pos,this.worldPoseLandmarks[h.POSE_LANDMARKS_LEFT.LEFT_ANKLE].pos]):(0,f.nt)([this.worldPoseLandmarks[h.POSE_LANDMARKS_RIGHT.RIGHT_HEEL].pos,this.worldPoseLandmarks[h.POSE_LANDMARKS_RIGHT.RIGHT_FOOT_INDEX].pos,this.worldPoseLandmarks[h.POSE_LANDMARKS_RIGHT.RIGHT_ANKLE].pos]),a="".concat(i,"Foot"),u=r.negateAxes(_.bN.yz).transpose([1,2,0]);u.verifyBasis();var c=o?this.leftFootNormal:this.rightFootNormal;c.copyFrom(u.z.negate());var d=this._boneRotations[a],y=d.baseBasis,m=u.rotateByQuaternion(this.applyQuaternionChain(a,o).conjugate()),p=(0,f.YW)(y,m),I=(0,_.ku)(p,_.bN.yz);e||d.set(I)}}}catch(k){n.e(k)}finally{n.f()}}},{key:"preProcessResults",value:function(){var e,n,i,s,o,r=null===(e=this.cloneableInputResults)||void 0===e?void 0:e.ea,a=null===(n=this.cloneableInputResults)||void 0===n?void 0:n.poseLandmarks;if(r&&a&&(r.length!==c.zL&&console.warn("Pose Landmark list has a length less than ".concat(c.zL,"!")),this.inputPoseLandmarks=this.preProcessLandmarks(r,this.worldPoseLandmarks),this.preProcessLandmarks(a,this.poseLandmarks),(r[h.POSE_LANDMARKS.LEFT_HIP].visibility||0)>d.n0&&(r[h.POSE_LANDMARKS.RIGHT_HIP].visibility||0)>d.n0)){var l=(0,c.eI)(this.poseLandmarks[h.POSE_LANDMARKS.LEFT_HIP].pos.add(this.poseLandmarks[h.POSE_LANDMARKS.RIGHT_HIP].pos).scaleInPlace(.5));l.z=0,this.midHipInitOffset||(this.midHipInitOffset=l,Object.freeze(this.midHipInitOffset)),this.midHipOffset.updatePosition(new u.Vector3(l.x-this.midHipInitOffset.x,l.y-this.midHipInitOffset.y,l.z-this.midHipInitOffset.z)),this.midHipPos=(0,c.eI)(this.midHipOffset.pos)}var _=null===(i=this.cloneableInputResults)||void 0===i?void 0:i.faceLandmarks;_&&(this.inputFaceLandmarks=this.preProcessLandmarks(_,this.faceLandmarks));var f=null===(s=this.cloneableInputResults)||void 0===s?void 0:s.leftHandLandmarks,y=null===(o=this.cloneableInputResults)||void 0===o?void 0:o.rightHandLandmarks;f&&(this.leftWristOffset.updatePosition(this.worldPoseLandmarks[h.POSE_LANDMARKS.LEFT_WRIST].pos.subtract((0,c.R$)(f[c.KS.WRIST],t.HAND_POSITION_SCALING,!0))),this.inputLeftHandLandmarks=this.preProcessLandmarks(f,this.leftHandLandmarks,this.leftWristOffset.pos,t.HAND_POSITION_SCALING)),y&&(this.rightWristOffset.updatePosition(this.worldPoseLandmarks[h.POSE_LANDMARKS.RIGHT_WRIST].pos.subtract((0,c.R$)(y[c.KS.WRIST],t.HAND_POSITION_SCALING,!0))),this.inputRightHandLandmarks=this.preProcessLandmarks(y,this.rightHandLandmarks,this.rightWristOffset.pos,t.HAND_POSITION_SCALING))}},{key:"preProcessLandmarks",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.Vector3.Zero(),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.map((function(t){t.x=t.x*i+n.x,t.y=-t.y*i+n.y,t.z=t.z*i+n.z}));for(var s=0;s<t.length;++s)e[s].updatePosition((0,c.R$)(t[s]),t[s].visibility);return t}},{key:"toCloneableLandmarks",value:function(t,e){e.forEach((function(e,n){e.x=t[n].pos.x,e.y=t[n].pos.y,e.z=t[n].pos.z,e.visibility=t[n].visibility}))}},{key:"filterFaceLandmarks",value:function(){var e=this;this._faceMeshLandmarkIndexList.length=0,this._faceMeshLandmarkList.length=0;for(var n=function(n){var i=[],s=new Set;t.FACE_MESH_CONNECTIONS[n].forEach((function(t){s.add(t[0]),s.add(t[1])}));var o=Array.from(s);e._faceMeshLandmarkIndexList.push(o);for(var r=0;r<o.length;r++)i.push({x:e.faceLandmarks[o[r]].pos.x,y:e.faceLandmarks[o[r]].pos.y,z:e.faceLandmarks[o[r]].pos.x,visibility:e.faceLandmarks[o[r]].visibility});e._faceMeshLandmarkList.push(i)},i=0;i<t.FACE_MESH_CONNECTIONS.length;++i)n(i)}},{key:"lRLinkWeights",value:function(){var e=(0,_.Gw)((0,c.R$)(this.faceNormal),new u.Vector3(0,0,-1),!0);return{weightLeft:(0,l.p6)(e.y,t.LR_FACE_DIRECTION_RANGE,-t.LR_FACE_DIRECTION_RANGE,0,1),weightRight:(0,l.p6)(e.y,-t.LR_FACE_DIRECTION_RANGE,t.LR_FACE_DIRECTION_RANGE,0,1)}}},{key:"lRLink",value:function(t,e){var n=this.lRLinkWeights();return n.weightLeft*t+n.weightRight*e}},{key:"lRLinkVector",value:function(t,e){var n=this.lRLinkWeights(),i=n.weightLeft,s=n.weightRight;return t.scale(i).addInPlace(e.scale(s))}},{key:"lRLinkQuaternion",value:function(t,e){var n=this.lRLinkWeights(),i=n.weightLeft,s=n.weightRight;return t.scale(i).addInPlace(e.scale(s))}},{key:"initHandBoneRotations",value:function(t){this._initBoneRotations[(0,c.TY)(c.KS.WRIST,t)]=new _.pc(u.Quaternion.Identity(),t?(0,f.nt)([new u.Vector3(0,0,0),new u.Vector3(t?1:-1,0,0),new u.Vector3(t?1:-1,0,1)]):new f.fE([new u.Vector3(-.9327159079568041,.12282522615654383,-.3390501421086685).normalize(),new u.Vector3(-.010002212677077182,.0024727643453822945,.028411551927747327).normalize(),new u.Vector3(.14320801411112857,.9890497926949048,-.03566472016590984).normalize()]));for(var e=1;e<4;++e){var n=new u.Vector3(t?1:-1,0,-1.5).normalize(),i=new u.Vector3(0,t?-1:1,0),s=u.Vector3.Cross(n,i).normalize(),o=new f.fE([n,i,s]).rotateByQuaternion(u.Quaternion.FromEulerAngles(0,0,t?.2:-.2));this._initBoneRotations[(0,c.TY)(e,t)]=new _.pc(u.Quaternion.Identity(),o)}for(var r=5;r<8;++r)this._initBoneRotations[(0,c.TY)(r,t)]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(t?1:-1,0,0),new u.Vector3(0,0,t?-1:1),new u.Vector3(0,1,0)]));for(var a=9;a<12;++a)this._initBoneRotations[(0,c.TY)(a,t)]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(t?1:-1,0,0),new u.Vector3(0,0,t?-1:1),new u.Vector3(0,1,0)]));for(var h=13;h<16;++h)this._initBoneRotations[(0,c.TY)(h,t)]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(t?1:-1,0,0),new u.Vector3(0,0,t?-1:1),new u.Vector3(0,1,0)]));for(var l=17;l<20;++l)this._initBoneRotations[(0,c.TY)(l,t)]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(t?1:-1,0,0),new u.Vector3(0,0,t?-1:1),new u.Vector3(0,1,0)]))}},{key:"initBoneRotations",value:function(){this.initHandBoneRotations(!0),this.initHandBoneRotations(!1),this._initBoneRotations.head=new _.pc(u.Quaternion.Identity(),new f.fE(null)),this._initBoneRotations.neck=new _.pc(u.Quaternion.Identity(),new f.fE(null)),this._initBoneRotations.hips=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(0,0,-1),new u.Vector3(-1,0,0),new u.Vector3(0,1,0)])),this._initBoneRotations.spine=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(0,0,-1),new u.Vector3(-1,0,0),new u.Vector3(0,1,0)]));for(var t=["left","right"],e=0,n=t;e<n.length;e++){var s=n[e],o="left"===s;this._initBoneRotations["".concat(s,"UpperArm")]=new _.pc(u.Quaternion.FromEulerAngles(0,0,o?1.0472:-1.0472),new f.fE([new u.Vector3(o?1:-1,0,0),new u.Vector3(0,0,o?-1:1),new u.Vector3(0,1,0)])),this._initBoneRotations["".concat(s,"LowerArm")]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(o?1:-1,0,0),new u.Vector3(0,0,o?-1:1),new u.Vector3(0,1,0)]))}for(var r=0,a=t;r<a.length;r++){var h=a[r],l="left"===h;this._initBoneRotations["".concat(h,"UpperLeg")]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(0,-1,0),new u.Vector3(-1,0,0),new u.Vector3(0,0,-1)]).rotateByQuaternion(u.Quaternion.FromEulerAngles(0,0,l?-.05236:.05236))),this._initBoneRotations["".concat(h,"LowerLeg")]=new _.pc(u.Quaternion.Identity(),new f.fE([new u.Vector3(0,-1,0),new u.Vector3(-1,0,0),new u.Vector3(0,0,-1)]).rotateByQuaternion(u.Quaternion.FromEulerAngles(0,0,l?-.0873:.0873)))}for(var c=0,d=t;c<d.length;c++){var y=d[c],m=new f.fE([new u.Vector3(0,-1,0),new u.Vector3(-1,0,0),new u.Vector3(0,0,-1)]);this._initBoneRotations["".concat(y,"Foot")]=new _.pc(u.Quaternion.Identity(),m)}this._initBoneRotations.mouth=new _.pc(u.Quaternion.Identity(),new f.fE(null)),this._initBoneRotations.blink=new _.pc(u.Quaternion.Identity(),new f.fE(null)),this._initBoneRotations.leftIris=new _.pc(u.Quaternion.Identity(),new f.fE(null)),this._initBoneRotations.rightIris=new _.pc(u.Quaternion.Identity(),new f.fE(null)),this._initBoneRotations.iris=new _.pc(u.Quaternion.Identity(),new f.fE(null)),Object.freeze(this._initBoneRotations);for(var p=0,I=Object.entries(this._initBoneRotations);p<I.length;p++){var k=(0,i.Z)(I[p],2),v=k[0],L=k[1];this._boneRotations[v]=new _.pc((0,_.hX)(L),L.baseBasis)}}},{key:"applyQuaternionChain",value:function(t,e){for(var n=u.Quaternion.Identity(),s=[],o=(0,c.I1)(this.bonesHierarchyTree,(function(n){var i=Number.isFinite(t)?(0,c.TY)(t,e):t;return n.name===i})),r=(0,i.Z)(o,2),a=r[0],h=r[1];h.has(a);){a=h.get(a);var l=this._boneRotations[a.name];s.push((0,_.ku)((0,_.hX)(l),_.bN.yz))}return s.reverse().map((function(t){n.multiplyInPlace(t)})),n.normalize(),n}},{key:"shallUpdateArm",value:function(t){var e,n,i=(null===(e=this.cloneableInputResults)||void 0===e?void 0:e.poseLandmarks[t?h.POSE_LANDMARKS.LEFT_SHOULDER:h.POSE_LANDMARKS.RIGHT_SHOULDER].visibility)||0,s=(null===(n=this.cloneableInputResults)||void 0===n?void 0:n.poseLandmarks[t?h.POSE_LANDMARKS.LEFT_WRIST:h.POSE_LANDMARKS.RIGHT_WRIST].visibility)||0;return!(i<=d.n0||s<=d.n0)}},{key:"shallUpdateLegs",value:function(t){var e,n,i,s,o=(null===(e=this.cloneableInputResults)||void 0===e?void 0:e.poseLandmarks[t?h.POSE_LANDMARKS_LEFT.LEFT_KNEE:h.POSE_LANDMARKS_RIGHT.RIGHT_KNEE].visibility)||0,r=(null===(n=this.cloneableInputResults)||void 0===n?void 0:n.poseLandmarks[t?h.POSE_LANDMARKS_LEFT.LEFT_ANKLE:h.POSE_LANDMARKS_RIGHT.RIGHT_ANKLE].visibility)||0,a=(null===(i=this.cloneableInputResults)||void 0===i?void 0:i.poseLandmarks[t?h.POSE_LANDMARKS_LEFT.LEFT_FOOT_INDEX:h.POSE_LANDMARKS_RIGHT.RIGHT_FOOT_INDEX].visibility)||0,u=(null===(s=this.cloneableInputResults)||void 0===s?void 0:s.poseLandmarks[t?h.POSE_LANDMARKS_LEFT.LEFT_HEEL:h.POSE_LANDMARKS_RIGHT.RIGHT_HEEL].visibility)||0;return!(o<=d.n0||r<=d.n0||a<=d.n0||u<=d.n0)}},{key:"pushBoneRotationBuffer",value:function(){if(this._boneRotationUpdateFn){var t=JSON.stringify(this._boneRotations),e=this.textEncoder.encode(t);this._boneRotationUpdateFn(a.re(e,[e.buffer]))}}}],[{key:"normalFromVertices",value:function(t,e){e&&t.reverse();for(var n=[],i=0;i<2;++i)n.push(t[i+1].pos.subtract(t[i].pos));return n[0].cross(n[1]).normalize()}}]),t}();m.FACE_MESH_CONNECTIONS=[h.FACEMESH_LEFT_EYEBROW,h.FACEMESH_RIGHT_EYEBROW,h.FACEMESH_LEFT_EYE,h.FACEMESH_RIGHT_EYE,h.FACEMESH_LEFT_IRIS,h.FACEMESH_RIGHT_IRIS,h.FACEMESH_LIPS,h.FACEMESH_FACE_OVAL],m.HAND_BASE_ROOT_NORMAL=new u.Vector3(0,-1,0),m.HAND_POSITION_SCALING=.8,m.IRIS_MP_X_RANGE=.027,m.IRIS_MP_Y_RANGE=.011,m.IRIS_BJS_X_RANGE=.28,m.IRIS_BJS_Y_RANGE=.12,m.BLINK_RATIO_LOW=.59,m.BLINK_RATIO_HIGH=.61,m.MOUTH_MP_RANGE_LOW=.001,m.MOUTH_MP_RANGE_HIGH=.06,m.EYE_WIDTH_BASELINE=.0546,m.MOUTH_WIDTH_BASELINE=.095,m.LR_FACE_DIRECTION_RANGE=27;var p={poses:m};a.Jj(p)}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.m=t,n.x=function(){var t=n.O(void 0,[637],(function(){return n(34817)}));return t=n.O(t)},function(){var t=[];n.O=function(e,i,s,o){if(!i){var r=1/0;for(l=0;l<t.length;l++){i=t[l][0],s=t[l][1],o=t[l][2];for(var a=!0,h=0;h<i.length;h++)(!1&o||r>=o)&&Object.keys(n.O).every((function(t){return n.O[t](i[h])}))?i.splice(h--,1):(a=!1,o<r&&(r=o));if(a){t.splice(l--,1);var u=s();void 0!==u&&(e=u)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,s,o]}}(),n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,i){return n.f[i](t,e),e}),[]))},n.u=function(t){return"static/js/"+t+".cc9e6140.chunk.js"},n.miniCssF=function(t){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/v3d-web-demo/",function(){var t={817:1};n.f.i=function(e,i){t[e]||importScripts(n.p+n.u(e))};var e=self.webpackChunkv3d_demo=self.webpackChunkv3d_demo||[],i=e.push.bind(e);e.push=function(e){var s=e[0],o=e[1],r=e[2];for(var a in o)n.o(o,a)&&(n.m[a]=o[a]);for(r&&r(n);s.length;)t[s.pop()]=1;i(e)}}(),function(){var t=n.x;n.x=function(){return n.e(637).then(t)}}();n.x()}();
//# sourceMappingURL=817.9778544b.chunk.js.map